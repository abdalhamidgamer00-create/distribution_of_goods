# ØªØ­Ø¯ÙŠØ« ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø§Ù†Ø­Ø© (Surplus Donors)

## Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙÙ†ÙØ°

ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚ ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„ØªÙŠ Ù„Ø¯ÙŠÙ‡Ø§ ÙØ§Ø¦Ø¶ Ù„ØªØ´Ù…Ù„ 3 Ù…Ø¹Ø§ÙŠÙŠØ± Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 1.

---

## âŒ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø¯ÙŠÙ…

```python
# ÙÙ‚Ø· Ø­Ø³Ø¨ surplus
branch_surplus.append((other_branch, available_surplus))
branch_surplus.sort(key=lambda x: -x[1])
```

**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©**: Ø¹Ù†Ø¯ ØªØ³Ø§ÙˆÙŠ surplusØŒ Ø§Ù„ØªØ±ØªÙŠØ¨ **Ø¹Ø´ÙˆØ§Ø¦ÙŠ**!

---

## âœ… Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯

```python
# surplus + balance + avg_sales
balance = branch_data[other_branch].iloc[idx]['balance']
avg_sales = branch_data[other_branch].iloc[idx]['avg_sales']

branch_surplus.append((other_branch, available_surplus, balance, avg_sales))

# Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù€3 Ù…Ø¹Ø§ÙŠÙŠØ±
branch_surplus.sort(key=lambda x: (-x[1], -x[2], x[3]))
#                                   â†‘      â†‘      â†‘
#                                surplus balance avg_sales
#                                (desc)  (desc)  (asc)
```

---

## Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª Ø§Ù„Ø«Ù„Ø§Ø«

### 1. Ø§Ù„Ø£Ø¹Ù„Ù‰ surplus (ØªÙ†Ø§Ø²Ù„ÙŠ) â¬‡ï¸
**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰**: Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø°ÙŠ Ù„Ø¯ÙŠÙ‡ Ø£ÙƒØ¨Ø± ÙØ§Ø¦Ø¶

### 2. Ø§Ù„Ø£Ø¹Ù„Ù‰ balance (ØªÙ†Ø§Ø²Ù„ÙŠ) â¬‡ï¸
**Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø§ÙˆÙŠ ÙÙŠ surplus**: Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£ØºÙ†Ù‰ (Ø±ØµÙŠØ¯ Ø£ÙƒØ¨Ø±) ÙŠØ¹Ø·ÙŠ Ø£ÙˆÙ„Ø§Ù‹

### 3. Ø§Ù„Ø£Ù‚Ù„ avg_sales (ØªØµØ§Ø¹Ø¯ÙŠ) â¬†ï¸
**Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø§ÙˆÙŠ ÙÙŠ surplus Ùˆ balance**: Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ù‚Ù„ Ù†Ø´Ø§Ø·Ø§Ù‹ (Ù…Ø¨ÙŠØ¹Ø§Øª Ø£Ù‚Ù„) ÙŠØ¹Ø·ÙŠ Ø£ÙˆÙ„Ø§Ù‹

---

## Ø§Ù„Ù…Ù†Ø·Ù‚

### Ù„Ù…Ø§Ø°Ø§ balance (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£ÙˆÙ„Ø§Ù‹)ØŸ
- Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø£ØºÙ†Ù‰ **Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹** ÙÙŠ Ø§Ù„Ø¹Ø·Ø§Ø¡
- Ù„Ø¯ÙŠÙ‡Ø§ **buffer Ø£ÙƒØ¨Ø±** Ø¶Ø¯ Ù†ÙØ§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- **Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©**: Ù…Ù† ÙŠÙ…Ù„Ùƒ Ø£ÙƒØ«Ø±ØŒ ÙŠØ¹Ø·ÙŠ Ø£ÙˆÙ„Ø§Ù‹

### Ù„Ù…Ø§Ø°Ø§ avg_sales (Ø§Ù„Ø£Ù‚Ù„ Ø£ÙˆÙ„Ø§Ù‹)ØŸ
- Ø§Ù„ÙØ±ÙˆØ¹ **Ø§Ù„Ø£Ù‚Ù„ Ù†Ø´Ø§Ø·Ø§Ù‹** Ù„Ø§ ØªØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù‚Ø¯Ø± Ø§Ù„Ø£Ù†Ø´Ø·
- **ØªØ­Ø±Ø± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†** Ù…Ù† Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„ØªÙŠ **Ù„Ø§ ØªØ³ØªØ®Ø¯Ù…Ù‡**
- **Ø§Ù„ÙƒÙØ§Ø¡Ø©**: Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠØ°Ù‡Ø¨ Ù„Ù„ÙØ±ÙˆØ¹ Ø§Ù„ØªÙŠ **ØªØ­ØªØ§Ø¬Ù‡ ÙØ¹Ù„Ø§Ù‹**

---

## Ù…Ø«Ø§Ù„ ØªÙˆØ¶ÙŠØ­ÙŠ

### Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
| Ø§Ù„ÙØ±Ø¹ | surplus | balance | avg_sales | Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù‚Ø¯ÙŠÙ… | Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ |
|-------|---------|---------|-----------|----------------|----------------|
| A | **10** | 25 | 0.5 | Ø¹Ø´ÙˆØ§Ø¦ÙŠ (1 Ø£Ùˆ 2) | **1** â¬†ï¸ (Ø£Ø¹Ù„Ù‰ balance) |
| B | **10** | 20 | 0.3 | Ø¹Ø´ÙˆØ§Ø¦ÙŠ (1 Ø£Ùˆ 2) | **2** |
| C | **10** | 25 | 0.7 | Ø¹Ø´ÙˆØ§Ø¦ÙŠ (3) | **3** (Ù†ÙØ³ balance Ù„ÙƒÙ† avg_sales Ø£Ø¹Ù„Ù‰) |
| D | 8 | 30 | 0.2 | 4 | **4** (surplus Ø£Ù‚Ù„) |

### Ø§Ù„ØªØ­Ù„ÙŠÙ„:
```python
# Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:
1. A: surplus=10, balance=25, avg_sales=0.5
   # Ø£Ø¹Ù„Ù‰ surplus (10)ØŒ Ø£Ø¹Ù„Ù‰ balance (25)

2. B: surplus=10, balance=20, avg_sales=0.3
   # Ù†ÙØ³ surplusØŒ Ù„ÙƒÙ† balance Ø£Ù‚Ù„

3. C: surplus=10, balance=25, avg_sales=0.7
   # Ù†ÙØ³ surplus Ùˆ balance Ù…Ø«Ù„ AØŒ Ù„ÙƒÙ† avg_sales Ø£Ø¹Ù„Ù‰ (Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹)
   # â†’ ÙŠØ­ØªÙØ¸ Ø¨Ù…Ø®Ø²ÙˆÙ†Ù‡ Ø£ÙƒØ«Ø±

4. D: surplus=8, balance=30, avg_sales=0.2
   # surplus Ø£Ù‚Ù„ â†’ ÙŠØ£ØªÙŠ Ø£Ø®ÙŠØ±Ø§Ù‹ Ø±ØºÙ… balance Ø£Ø¹Ù„Ù‰
```

---

## Ø§Ù„ÙÙˆØ§Ø¦Ø¯

| Ø§Ù„Ù…ÙŠØ²Ø© | Ø§Ù„ÙˆØµÙ |
|--------|-------|
| **Ø§Ù„Ø«Ø¨Ø§Øª** | ØªØ±ØªÙŠØ¨ Ø«Ø§Ø¨Øª ÙˆÙ…Ø­Ø¯Ø¯ (Ù„ÙŠØ³ Ø¹Ø´ÙˆØ§Ø¦ÙŠ) âœ… |
| **Ø§Ù„Ø£Ù…Ø§Ù†** | Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø£ØºÙ†Ù‰ ØªØ¹Ø·ÙŠ Ø£ÙˆÙ„Ø§Ù‹ (Ø£Ù‚Ù„ Ø®Ø·Ø±) âœ… |
| **Ø§Ù„ÙƒÙØ§Ø¡Ø©** | Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙØ­Ø±Ø± Ù…Ù† Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø£Ù‚Ù„ Ù†Ø´Ø§Ø·Ø§Ù‹ âœ… |
| **Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©** | Ø§Ù„Ù…Ù†Ø·Ù‚ ÙˆØ§Ø¶Ø­ ÙˆÙ…ÙÙ‡ÙˆÙ… âœ… |

---

## Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ²ÙŠØ¹

### Ù‚Ø¨Ù„ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø§ÙˆÙŠ):
```
surplus=10: [A, B] â†’ Ù‚Ø¯ ÙŠÙƒÙˆÙ† B Ø«Ù… A (Ø¹Ø´ÙˆØ§Ø¦ÙŠ)
```

### Ø¨Ø¹Ø¯ (Ù…Ø­Ø¯Ø¯):
```
surplus=10, balance: A(25) > B(20) â†’ Ø¯Ø§Ø¦Ù…Ø§Ù‹ A Ø«Ù… B âœ…
surplus=10, balance=25, avg_sales: A(0.5) < C(0.7) â†’ A Ø«Ù… C âœ…
```

---

## Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ÙØ¹Ø¯Ù„

**Ø§Ù„Ù…Ù„Ù**: `src/core/domain/calculations/order_calculator.py`  
**Ø§Ù„Ø¯Ø§Ù„Ø©**: `get_surplus_branches_order_for_product()`

**Ø§Ù„ØªØºÙŠÙŠØ±**:
```python
# Ø¥Ø¶Ø§ÙØ© balance Ùˆ avg_sales
branch_surplus.append((other_branch, available_surplus, balance, avg_sales))

# Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù€3 Ù…Ø¹Ø§ÙŠÙŠØ±
sort(key=lambda x: (-x[1], -x[2], x[3]))
```

---

## Ø§Ù„Ø®Ù„Ø§ØµØ©

**Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ**:
1. ðŸ¥‡ **surplus** (Ø§Ù„Ø£ÙƒØ¨Ø±) - Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰
2. ðŸ¥ˆ **balance** (Ø§Ù„Ø£ÙƒØ¨Ø±) - Ù„Ù„ØªØ­ÙƒÙŠÙ… Ø§Ù„Ø£ÙˆÙ„
3. ðŸ¥‰ **avg_sales** (Ø§Ù„Ø£ØµØºØ±) - Ù„Ù„ØªØ­ÙƒÙŠÙ… Ø§Ù„Ø«Ø§Ù†ÙŠ

**Ø§Ù„Ù…Ù†Ø·Ù‚**: "Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ø£ØºÙ†Ù‰ ÙˆØ§Ù„Ø£Ù‚Ù„ Ù†Ø´Ø§Ø·Ø§Ù‹ ØªØ¹Ø·ÙŠ Ø£ÙˆÙ„Ø§Ù‹" ðŸŽ¯âœ…

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«**: 6 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025
