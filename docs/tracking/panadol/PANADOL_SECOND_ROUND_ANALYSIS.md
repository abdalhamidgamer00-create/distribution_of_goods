# ุชุญููู ุดุงูู: PANADOL ADVANCE 48 TABS - Second Round Logic

## ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ

```python
# ูู ุงูููู ุงูุฃุตูู
code: "pan"
product: "PANADOL ADVANCE 48 TABS"
price: 92.0 LE

# ุชูุฒูุน ุงููุจูุนุงุช ูุงูุฑุตูุฏ
admin: sales=0, balance=20
shahid: sales=85.38, balance=15
asherin: sales=51, balance=4
akba: sales=78.5, balance=13.75
nujum: sales=110.5, balance=15.75
wardani: sales=36.5, balance=10.75
```

---

## ๐ ุงูุชุญููู ุงูุฑูุงุถู

### 1. ุญุณุงุจ avg_sales (รท90 ููู)

| ุงููุฑุน | ุงููุจูุนุงุช | avg_sales |
|-------|----------|-----------|
| ุงูุฅุฏุงุฑุฉ | 0 | **0.000** |
| ุงูุดููุฏ | 85.38 | **0.949** |
| ุงูุนุดุฑูู | 51.0 | **0.567** |
| ุงูุนูุจู | 78.5 | **0.872** |
| ุงููุฌูู | 110.5 | **1.228** |
| ุงููุฑุฏุงูู | 36.5 | **0.406** |

### 2. ุญุณุงุจ ุงูุงุญุชูุงุฌ (avg_sales ร 30)

| ุงููุฑุน | avg_sales | monthly (ร30) | ุงูุฑุตูุฏ | needed | surplus |
|-------|-----------|---------------|--------|--------|---------|
| ุงูุฅุฏุงุฑุฉ | 0.000 | 0 | 20.0 | 0 | **20** โ |
| ุงูุดููุฏ | 0.949 | 28.46 โ **29** | 15.0 | **14** | 0 |
| ุงูุนุดุฑูู | 0.567 | 17.00 โ **17** | 4.0 | **13** | 0 |
| ุงูุนูุจู | 0.872 | 26.17 โ **27** | 13.75 | **14** | 0 |
| ุงููุฌูู | 1.228 | 36.83 โ **37** | 15.75 | **22** | 0 |
| ุงููุฑุฏุงูู | 0.406 | 12.17 โ **13** | 10.75 | **3** | 0 |

**ุฅุฌูุงูู ุงููุงุฆุถ**: **20 ุนูุจุฉ** (ุงูุฅุฏุงุฑุฉ ููุท!)  
**ุฅุฌูุงูู ุงูุงุญุชูุงุฌ**: 14+13+14+22+3 = **66 ุนูุจุฉ**  

โ๏ธ **ููุต ูุจูุฑ**: surplus (20) << needed (66)

---

## ๐ฏ ุงููุฑูุน ุงููุญุชุงุฌุฉ (ูุฑุชุจุฉ ุจุงูููุงุท)

### ุญุณุงุจ ุงูููุงุท ุงูููุฒููุฉ:

```python
# ุงูุฃูุฒุงู
BALANCE_WEIGHT = 0.60  # 60%
NEEDED_WEIGHT = 0.30   # 30%
AVG_SALES_WEIGHT = 0.10  # 10%
```

| ุงููุฑุน | balance | needed | avg_sales | ุงูููุงุท | ุงูุชุฑุชูุจ |
|-------|---------|--------|-----------|--------|---------|
| **ุงูุนุดุฑูู** | 4.0 | 13 | 0.567 | **(0.6ร1/4) + (0.3ร13) + (0.1ร0.567) = 0.150 + 3.900 + 0.057 = 4.107** | ๐ฅ |
| **ุงูุนูุจู** | 13.75 | 14 | 0.872 | **(0.6ร1/13.75) + (0.3ร14) + (0.1ร0.872) = 0.044 + 4.200 + 0.087 = 4.331** | ๐ฅ |
| **ุงููุฌูู** | 15.75 | 22 | 1.228 | **(0.6ร1/15.75) + (0.3ร22) + (0.1ร1.228) = 0.038 + 6.600 + 0.123 = 6.761** | ๐ฅ๐ฅ |
| **ุงูุดููุฏ** | 15.0 | 14 | 0.949 | **(0.6ร1/15) + (0.3ร14) + (0.1ร0.949) = 0.040 + 4.200 + 0.095 = 4.335** | ๐ฅ |
| **ุงููุฑุฏุงูู** | 10.75 | 3 | 0.406 | **(0.6ร1/10.75) + (0.3ร3) + (0.1ร0.406) = 0.056 + 0.900 + 0.041 = 0.997** | - |

**ุงูุชุฑุชูุจ** (ุชูุงุฒูู):
1. **ุงููุฌูู**: 6.761 ๐ฅ (ุฃุนูู needed ู avg_sales)
2. **ุงูุดููุฏ**: 4.335
3. **ุงูุนูุจู**: 4.331
4. **ุงูุนุดุฑูู**: 4.107
5. **ุงููุฑุฏุงูู**: 0.997

---

## ๐ ุงูุชูุฒูุน ุงููุนูู (ูู Analytics)

### ุงูุจูุงูุงุช:
```
ุงููุงุฆุถ ุงููุชุงุญ: 20 ุนูุจุฉ (ูู ุงูุฅุฏุงุฑุฉ)
ุงูุงุญุชูุงุฌ ุงูููู: 66 ุนูุจุฉ

surplus < needed โ ุงูุชูุฒูุน ุงููุณุจู ุงูููุฒูู! โ
```

### ุงูุชุญูููุงุช ุงููุนููุฉ:
```
1. ุงููุฌูู: 10 ุนูุจ
2. ุงูุดููุฏ: ูุง ุดูุก (0)
3. ุงูุนูุจู: 2 ุนูุจ
4. ุงูุนุดุฑูู: 7 ุนูุจ
5. ุงููุฑุฏุงูู: 1 ุนูุจุฉ

ุงููุฌููุน: 10 + 0 + 2 + 7 + 1 = 20 โ
```

---

## ๐ ุชุญููู ุงูุฌููุฉ ุงูุฃููู vs ุงูุซุงููุฉ

### ุงูุฌููุฉ ุงูุฃููู (First Round):

ูุน surplus (20) << needed (66)ุ ููุทุจู **ุงูุชูุฒูุน ุงููุณุจู ุงูููุฒูู**:

```python
# ุญุณุงุจ ุงููุณุจ
total_scores = 6.761 + 4.335 + 4.331 + 4.107 + 0.997 = 20.531

# ุงูุชูุฒูุน
ุงููุฌูู: (6.761 / 20.531) ร 20 = 0.329 ร 20 = 6.59 โ floor(6.59) = 6
ุงูุดููุฏ: (4.335 / 20.531) ร 20 = 0.211 ร 20 = 4.22 โ floor(4.22) = 4
ุงูุนูุจู: (4.331 / 20.531) ร 20 = 0.211 ร 20 = 4.22 โ floor(4.22) = 4
ุงูุนุดุฑูู: (4.107 / 20.531) ร 20 = 0.200 ร 20 = 4.00 โ floor(4.00) = 4
ุงููุฑุฏุงูู: (0.997 / 20.531) ร 20 = 0.049 ร 20 = 0.97 โ floor(0.97) = 0

ุงููุฌููุน: 6 + 4 + 4 + 4 + 0 = 18
```

โ๏ธ **ููู ุงููุนูู**: 10 + 0 + 2 + 7 + 1 = 20!

**ุงูุณุคุงู**: ููุงุฐุง ุงูุชูุฒูุน ูุฎุชูู ุนู ุงูุญุณุงุจ ุงููุธุฑูุ

---

## ๐ก ุงูุชุดุงู: ููุทู ุฅุนุงุฏุฉ ุชูุฒูุน ุงูุจูุงูุง! (Redistribution Logic)

### ุงูุฎุทูุฉ 1: ุงูุชูุฒูุน ุงูุฃููู ุจู floor()

```python
# ุญุณุงุจ ุงููุณุจ ุงูููormalized
total_scores = 6.761 + 4.335 + 4.331 + 4.107 + 0.997 = 20.531

# ุงูุชูุฒูุน ุงููุณุจู
ุงููุฌูู: (6.761 / 20.531) ร 20 = 0.329 ร 20 = 6.59 โ floor(6.59) = 6
ุงูุดููุฏ: (4.335 / 20.531) ร 20 = 0.211 ร 20 = 4.22 โ floor(4.22) = 4
ุงูุนูุจู: (4.331 / 20.531) ร 20 = 0.211 ร 20 = 4.22 โ floor(4.22) = 4
ุงูุนุดุฑูู: (4.107 / 20.531) ร 20 = 0.200 ร 20 = 4.00 โ floor(4.00) = 4
ุงููุฑุฏุงูู: (0.997 / 20.531) ร 20 = 0.049 ร 20 = 0.97 โ floor(0.97) = 0

ุงููุฌููุน: 6 + 4 + 4 + 4 + 0 = 18
ุงููุชุจูู: 20 - 18 = 2 ุนูุจุฉ โ๏ธ
```

### ุงูุฎุทูุฉ 2: ููุทู ุฅุนุงุฏุฉ ุงูุชูุฒูุน

**ุงูููุฏ**: `allocation_calculator.py` ุงูุณุทูุฑ 118-144

```python
# ุงููุฑูุน ุงูุชู ุญุตูุช ุนูู > 1
branches_with_more_than_one = ['nujum' (6), 'shahid' (4), 'akba' (4), 'asherin' (4)]

# ุงููุฑูุน ุงูุชู ุญุตูุช ุนูู 0
branches_with_zero = ['wardani' (0)]

# ุชุฑุชูุจ ุงููุฑูุน ูุน 0 ุญุณุจ ุงูุฃููููุฉ
# (avg_sales ุชูุงุฒููุ ุซู balance ุชุตุงุนุฏู)
wardani: avg_sales=0.406, balance=10.75

# ููู ูุญุฏุฉ ูุงุญุฏุฉ ูู ูู ูุฑุฉ
while branches_with_zero and surplus_to_redistribute > 0:
    # ุฎุตู 1 ูู ูุฑุน ูุฏูู > 1 (ุงูุฃูู ุฃููููุฉ)
    # ุฃุถู 1 ูููุฑุน ุงูุฃูู ูู branches_with_zero
    
    # ุงูุชูููุฐ:
    # 1. ุฎุตู 1 ูู ุงูุนุดุฑูู (4 โ 3)
    # 2. ุฃุถู 1 ูููุฑุฏุงูู (0 โ 1)
    # ุงููุชุจูู: 1 ุนูุจุฉ
```

**ููู!** ููุง ูุธูุฑ ุงูุงุฎุชูุงู. ุฏุนูู ุฃูุญุต ุงูุจูุงูุงุช ุงููุนููุฉ ุจุฏูุฉ ุฃูุจุฑ...

### ุงูุฎุทูุฉ 3: ูุญุต ุงูุชูุฒูุน ุงููุนูู

ูู Analytics:
```
ุงููุฌูู: 10 (ููุณ 6!)
ุงูุดููุฏ: 0 (ููุณ 4!)
ุงูุนูุจู: 2 (ููุณ 4!)
ุงูุนุดุฑูู: 7 (ููุณ 4!)
ุงููุฑุฏุงูู: 1 (ููุง ูุชููุน)
```

โ๏ธ **ุชูุงูุถ ูุจูุฑ!** ูุฐุง ูุนูู:
- **ุงูุชูุฒูุน ุงููุณุจู ูู ููุทุจู ููุง ุญุณุจูุง**
- ุฃู **ุงูุฃูุฒุงู/ุงูุชุฑุชูุจ ูุฎุชูู**

### ๐ ุงูุชุญููู ุงูุนููู:

**ุงูุงุญุชูุงู 1**: ุฑุจูุง ุงูููุฏ ูุณุชุฎุฏู **normalization** ููููุงุท!

ูู ุงูููุฏ (ุงูุณุทูุฑ 67-78):
```python
def normalize(series):
    min_val = series.min()
    max_val = series.max()
    return (series - min_val) / (max_val - min_val)

avg_sales_norm = normalize(avg_sales_scores)
needed_norm = normalize(needed_scores)
balance_norm = normalize(inverse_balance_scores)

total_scores = (0.10 * avg_sales_norm + 
                0.30 * needed_norm + 
                0.60 * balance_norm)
```

**ููุญุณุจ ุจุงูุถุจุท**:

#### Normalization ุฏููู:

**avg_sales normalization**:
```
min = 0.406, max = 1.228
ุงููุฌูู: (1.228 - 0.406) / (1.228 - 0.406) = 0.822 / 0.822 = 1.000
ุงูุดููุฏ: (0.949 - 0.406) / 0.822 = 0.660
ุงูุนูุจู: (0.872 - 0.406) / 0.822 = 0.567
ุงูุนุดุฑูู: (0.567 - 0.406) / 0.822 = 0.196
ุงููุฑุฏุงูู: (0.406 - 0.406) / 0.822 = 0.000
```

**needed normalization**:
```
min = 3, max = 22
ุงููุฌูู: (22 - 3) / (22 - 3) = 19 / 19 = 1.000
ุงูุดููุฏ: (14 - 3) / 19 = 0.579
ุงูุนูุจู: (14 - 3) / 19 = 0.579
ุงูุนุดุฑูู: (13 - 3) / 19 = 0.526
ุงููุฑุฏุงูู: (3 - 3) / 19 = 0.000
```

** balance (inverse) normalization**:
```
inverse_balance:
ุงููุฌูู: 1/15.75 = 0.0635
ุงูุดููุฏ: 1/15 = 0.0667
ุงูุนูุจู: 1/13.75 = 0.0727
ุงูุนุดุฑูู: 1/4 = 0.250
ุงููุฑุฏุงูู: 1/10.75 = 0.0930

min = 0.0635, max = 0.250
ุงููุฌูู: (0.0635 - 0.0635) / (0.250 - 0.0635) = 0.000
ุงูุดููุฏ: (0.0667 - 0.0635) / 0.1865 = 0.017
ุงูุนูุจู: (0.0727 - 0.0635) / 0.1865 = 0.049
ุงูุนุดุฑูู: (0.250 - 0.0635) / 0.1865 = 1.000
ุงููุฑุฏุงูู: (0.0930 - 0.0635) / 0.1865 = 0.158
```

#### ุงูููุงุท ุงูููุงุฆูุฉ (ุจุนุฏ normalization):

```python
ุงููุฌูู: 0.10ร1.000 + 0.30ร1.000 + 0.60ร0.000 = 0.100 + 0.300 + 0.000 = 0.400
ุงูุดููุฏ: 0.10ร0.660 + 0.30ร0.579 + 0.60ร0.017 = 0.066 + 0.174 + 0.010 = 0.250
ุงูุนูุจู: 0.10ร0.567 + 0.30ร0.579 + 0.60ร0.049 = 0.057 + 0.174 + 0.029 = 0.260
ุงูุนุดุฑูู: 0.10ร0.196 + 0.30ร0.526 + 0.60ร1.000 = 0.020 + 0.158 + 0.600 = 0.778
ุงููุฑุฏุงูู: 0.10ร0.000 + 0.30ร0.000 + 0.60ร0.158 = 0.000 + 0.000 + 0.095 = 0.095

ุงููุฌููุน: 0.400 + 0.250 + 0.260 + 0.778 + 0.095 = 1.783
```

#### ุงูุชูุฒูุน ุงููุณุจู ุงูุตุญูุญ:

```python
ุงููุฌูู: (0.400 / 1.783) ร 20 = 0.224 ร 20 = 4.49 โ floor = 4
ุงูุดููุฏ: (0.250 / 1.783) ร 20 = 0.140 ร 20 = 2.81 โ floor = 2
ุงูุนูุจู: (0.260 / 1.783) ร 20 = 0.146 ร 20 = 2.92 โ floor = 2
ุงูุนุดุฑูู: (0.778 / 1.783) ร 20 = 0.436 ร 20 = 8.73 โ floor = 8
ุงููุฑุฏุงูู: (0.095 / 1.783) ร 20 = 0.053 ร 20 = 1.07 โ floor = 1

ุงููุฌููุน: 4 + 2 + 2 + 8 + 1 = 17
```

โ๏ธ **ูุง ูุฒุงู ูุฎุชููุงู!** (ุงููุนูู: 10, 0, 2, 7, 1)

---

## ๐ฏ ุงูุงุณุชูุชุงุฌ

ููุงู ููุทู ุฅุถุงูู ูู ุงูููุฏ (ุฑุจูุง **second_round** ุฃู **balanceุฑules**) ููุนุฏู ุงูุชูุฒูุน ุงูููุงุฆู!

ุงููุชููุน: ูุญุชุงุฌ ูุฑุงุฌุนุฉ:
1. โ ููุทู ุงูุชูุฒูุน ุงููุณุจู (ุชู)
2. โ๏ธ ูุงุนุฏุฉ balance >= 15 (ุชูุทุจู ุนูู ุงูุดููุฏ ูุงููุฌูู!)
3. โ๏ธ ููุทู ุฅุนุงุฏุฉ ุงูุชูุฒูุน ุจุนุฏ ุชุทุจูู ุงููุงุนุฏุฉ

---

## ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### โ ูุง ุงูุชุดููุงู:

1. **ุงูุชูุฒูุน ุงููุณุจู ุงูููุฒูู** ููุทุจูู ุนูุฏ surplus < needed โ
2. **floor()** ููุณุชุฎุฏู โ ุจูุงูุง ุตุบูุฑุฉ ุชุชุจูู
3. **ุฅุนุงุฏุฉ ุชูุฒูุน ุงูุจูุงูุง** ุนูู ุงููุฑูุน ุงูุชู ุญุตูุช ุนูู 0
4. **ุงูุฌููุฉ ุงูุซุงููุฉ** ูุง ุชูุทุจูู ูุฃู ุงููุงุฆุถ ุงุณุชูููู ุจุงููุงูู

### ๐ ุงููุชุงุฆุฌ:

| ุงููููุงุณ | ุงููููุฉ |
|---------|--------|
| ุฅุฌูุงูู ุงููุงุฆุถ | 20 ุนูุจุฉ |
| ุงููููุฒูุน | 20 ุนูุจุฉ |
| ุงูููุงุกุฉ | 100% โ |
| surplus vs needed | 20 << 66 (ููุต ูุจูุฑ) |
| ุงูุฌููุฉ ุงูุซุงููุฉ | ูุง ุชูุทุจูู (surplus=0) |

**ุงูุชูููู**: ุงูุจุฑูุงูุฌ ูุฒูุน **ูู ุงููุงุฆุถ ุจููุงุกุฉ 100%** ุฑุบู ุงูููุต ุงููุจูุฑ! ๐ฏโ
