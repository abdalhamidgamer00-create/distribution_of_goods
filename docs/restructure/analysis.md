# بنية المشروع الحالية - تقييم وتحليل

## نظرة عامة على الشجرة الحالية
- مجلد `src/` يتكون من مجلدات وظيفية منفصلة (analyzers, classifiers, converters, splitters، إلخ) بدون مستويات واضحة للدومين/الخدمات/التطبيق.
- خطوات الـ CLI (الخطوات 1-9) موجودة في `src/config/` بينما منطق الأعمال موزع بين وحدات متعددة.
- `splitters/` يحتوي على هرم عميق من المجلدات (calculators، processors، writers) لكنه مرتبط بملفات أخرى مثل `transfer_generators/` التي تحتوي على منطق مشابه.
- مجلدات البيانات (`data/output`, `data/archive`) تحتوي على مخرجات كثيرة، مما يصعّب تشغيل الاختبارات محليًا بدون تنظيف.

## المشاكل المكتشفة
1. **تكرار في التحقق من الأعمدة والملفات**
   - وظائف مثل التأكد من الأعمدة المطلوبة موجودة في أكثر من ملف (مثلاً مولد التحويل وتقسيم ملفات التحويل).
   - لا يوجد مركز موحد للتحقق من جودة DataFrame أو 
     I/O.

2. **تشابك المسؤوليات**
   - ملفات مثل `splitters/branch_splitter.py` تحوي منطق تحضير البيانات، حساب التوزيع، كتابة الملفات، وتجميع الإحصاءات.
   - `transfer_generators/` يكرر جزءًا من منطق السحب/التوزيع الموجود في `splitters/` بدل الاعتماد على خدمات مشتركة.

3. **هيكلة مجلدات غير واضحة**
   - تداخل بين ما هو "خدمة" (مثل التحويل بين الصيغ) وما هو "دومين" (حساب الكميات، التحقق من البيانات).
   - صعوبة تتبع المسارات (مثلاً `src/splitters/calculators/allocation_calculator.py` و `src/transfer_generators/splitters/file_splitter.py`).

4. **اختبارات محدودة**
   - يوجد فقط ملف اختبار واحد (`tests/test_distribution_logic.py`) ولا يغطي بقية الخطوات (التحويل، التقارير، إلخ).

## متطلبات إعادة التنظيم
- تجميع الوحدات حسب طبقات واضحة (core domain, services, app/cli, shared).
- إنشاء وحدات أدوات مشتركة لتقليل التكرار (مثل التحقق من الأعمدة، عمليات I/O للبيانات).
- تفكيك الملفات الضخمة وإعادة توزيع المسؤوليات.
- إضافة آلية اختبار أو على الأقل سكربت تحقق شامل بعد كل خطوة.
